<!doctype html>
<html lang="en">
<head>
  <!-- feedplayer.html is sent to dist/index.html during Yarn Build -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="manifest" href="favicons/site.webmanifest">
  <link rel="mask-icon" href="favicons/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <title>Feed Player</title>

  <script type="text/javascript" src="https://model.earth/localsite/js/localsite.js?showheader=true"></script>
  
  <script>
  
  loadMarkdown("/feed/README.md", "readmeDiv", "_parent");

  window.onload = function() {
    if (performance.navigation.type === 1) {
      // This is a page refresh
      history.replaceState(null, null, ' ');
    }
  };

  </script>

  <style>
    .swiper-section {
      height: 300px;
      width: 100%;
      overflow: hidden;
      margin-bottom:0;
    }
    </style>

</head>

<body>
  <div id="root"></div>
  <script type="module" src="/src/main.jsx"></script>
  <object type="text/html" class="swiper-section" data="/swiper/dist/loop.html" scrolling="no"></object>

  <div class="content contentpadding large-list" style="padding-top:10px">
    <div id="readmeDiv"></div>
  </div>

  <script>
    const allowedOrigins = ['https://model.earth', 'https://raydendarkus.github.io', 'http://localhost:8887', 'http://localhost:5173'];
    // Function to handle hash changes
    function handleHashChange() {
        const hashParams = new URLSearchParams(window.location.hash.substring(1));
        const scene = parseInt(hashParams.get('scene'), 10);
        if (scene > 0 && scene <= 18) {
            const iframe = document.querySelector('.swiper-section');
            if (iframe && iframe.contentWindow) 
              iframe.contentWindow.postMessage({ action: 'changeSlide', scene: scene }, '*');
        }
    }
    // Function to handle messages from the iframe
    function handleMessage(event) {
        if (allowedOrigins.includes(event.origin)) {
            const { index, source } = event.data;
            if (source === 'loop' && !isNaN(index) && index > 0 && index <= 18) 
                history.replaceState(null, null, `#feed=nasa&scene=${index}`);
        }
    }
    // Set up event listeners
    window.addEventListener('hashchange', handleHashChange);
    window.addEventListener('message', handleMessage);
  
    // Clean up function to prevent memory leaks
    window.addEventListener('unload', () => {
      window.removeEventListener('hashchange', handleHashChange);
      window.removeEventListener('message', handleMessage);
    });
    </script>
</body>

</html>